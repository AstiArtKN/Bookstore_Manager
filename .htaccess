# --------------------------------------------
# BẬT REWRITE ENGINE
# --------------------------------------------
RewriteEngine On

# Nếu project nằm trong thư mục con, ví dụ /D_A_Manager_BookStore/
# thì bỏ comment dòng dưới và sửa lại tên thư mục
# RewriteBase /D_A_Manager_BookStore/

# --------------------------------------------
# REWRITE URL ĐẸP (chuyển tất cả request về index.php nếu không phải file thật)
# --------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [L]

# --------------------------------------------
# CHẶN TRUY CẬP THƯ MỤC NHẠY CẢM
# --------------------------------------------
RewriteRule ^includes/ - [F,L]
RewriteRule ^modules/ - [F,L]
RewriteRule ^config/ - [F,L]

# Không cho upload file PHP trong uploads chạy được
RewriteRule ^templates/uploads/.*\.(php|php5|phtml|phar)$ - [F,L]

# --------------------------------------------
# CHẶN CÁC FILE NHẠY CẢM
# --------------------------------------------
<FilesMatch "(?i)(\.env|\.sql|\.log|\.ini|\.bak|config\.php|database\.php|function\.php|\.htaccess)$">
    Require all denied
</FilesMatch>

# --------------------------------------------
# CHẶN LIỆT KÊ TÊN FILE (Directory Listing)
# --------------------------------------------
# Không cho phép hiển thị danh sách file khi vào thư mục
Options -Indexes

# Nếu người dùng truy cập vào thư mục không có index, báo lỗi 403
ErrorDocument 403 "Truy cập bị từ chối."

# --------------------------------------------
# BẬT NÉN DỮ LIỆU (Tối ưu tốc độ)
# --------------------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# --------------------------------------------
# BẬT CACHE (Tăng tốc website)
# --------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 30 days"
  ExpiresByType image/jpeg "access plus 30 days"
  ExpiresByType image/png "access plus 30 days"
  ExpiresByType text/css "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
</IfModule>
